{% extends "sidebar.html" %}

{% block content %}
<div class="container mx-auto p-6 bg-gray-50 min-h-screen">

    <!-- Flash Messages -->
    {% if messages %}
        <div class="space-y-4 mb-6">
            {% for message in messages %}
                <div class="p-4 rounded-lg shadow-md 
                    {% if message.tags == 'error' %}
                        bg-red-100 border-l-4 border-red-500 text-red-700
                    {% elif message.tags == 'success' %}
                        bg-green-100 border-l-4 border-green-500 text-green-700
                    {% else %}
                        bg-blue-100 border-l-4 border-blue-500 text-blue-700
                    {% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Header -->
    <div class="text-center mb-10">
        <h1 class="text-4xl font-extrabold text-blue-600">Leave Policy Management</h1>
        <p class="mt-2 text-gray-600">Manage leave types, policies, and periods</p>
    </div>

    <!-- Tabs -->
    <div class="mb-8">
        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                <button id="tab-leave-types" class="border-blue-500 text-blue-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm active-tab" aria-current="page">
                    Leave Types
                </button>
                <button id="tab-leave-policies" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    Employee Leave Policies
                </button>
                <button id="tab-leave-periods" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    Leave Periods
                </button>
            </nav>
        </div>
    </div>

    <!-- Leave Types Tab Content -->
    <div id="content-leave-types" class="tab-content">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Leave Type Form -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-700 text-white py-4 px-6">
                        <h2 class="text-lg font-semibold">{% if edit_leave_type %}Edit{% else %}Add{% endif %} Leave Type</h2>
                    </div>
                    <div class="p-6">
                        <form method="post" action="{% url 'add_leave_type' %}" class="space-y-4">
                            {% csrf_token %}
                            {% if edit_leave_type %}
                            <input type="hidden" name="leave_type_id" value="{{ edit_leave_type.id }}">
                            {% endif %}
                            
                            <div>
                                <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
                                <input type="text" name="name" id="name" value="{% if edit_leave_type %}{{ edit_leave_type.name }}{% endif %}" required class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                {% if form.name.errors %}
                                <p class="mt-2 text-sm text-red-600">{{ form.name.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
                                <textarea name="description" id="description" rows="3" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">{% if edit_leave_type %}{{ edit_leave_type.description }}{% endif %}</textarea>
                                {% if form.description.errors %}
                                <p class="mt-2 text-sm text-red-600">{{ form.description.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            <div class="flex items-start">
                                <div class="flex items-center h-5">
                                    <input type="checkbox" name="is_freezable" id="is_freezable" {% if edit_leave_type and edit_leave_type.is_freezable %}checked{% endif %} class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded">
                                </div>
                                <div class="ml-3 text-sm">
                                    <label for="is_freezable" class="font-medium text-gray-700">Freezable</label>
                                    <p class="text-gray-500">Can unused leave be frozen for future use?</p>
                                </div>
                            </div>
                            
                            <div class="flex justify-end">
                                {% if edit_leave_type %}
                                <a href="{% url 'leave_policy_management' %}" class="mr-3 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    Cancel
                                </a>
                                {% endif %}
                                <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    {% if edit_leave_type %}Update{% else %}Add{% endif %} Leave Type
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Leave Types List -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-green-500 to-green-700 text-white py-4 px-6">
                        <h2 class="text-lg font-semibold">Leave Types</h2>
                    </div>
                    <div class="p-6">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Freezable</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for leave_type in leave_types %}
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ leave_type.name }}</td>
                                        <td class="px-6 py-4 text-sm text-gray-500">{{ leave_type.description|truncatechars:50 }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full 
                                                {% if leave_type.is_freezable %}bg-blue-100 text-blue-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                                                {% if leave_type.is_freezable %}Yes{% else %}No{% endif %}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <a href="{% url 'edit_leave_type' leave_type.id %}" class="text-blue-600 hover:text-blue-900 mr-3">Edit</a>
                                            <a href="{% url 'delete_leave_type' leave_type.id %}" class="text-red-600 hover:text-red-900" onclick="return confirm('Are you sure you want to delete this leave type?');">Delete</a>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="4" class="px-6 py-4 text-center text-sm text-gray-500">No leave types found.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Employee Leave Policies Tab Content -->
    <div id="content-leave-policies" class="tab-content hidden">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Leave Policy Form -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-700 text-white py-4 px-6">
                        <h2 class="text-lg font-semibold">{% if edit_policy %}Edit{% else %}Add{% endif %} Leave Policy</h2>
                    </div>
                    <div class="p-6">
                        <form method="post" action="{% url 'add_leave_policy' %}" class="space-y-4">
                            {% csrf_token %}
                            {% if edit_policy %}
                            <input type="hidden" name="policy_id" value="{{ edit_policy.id }}">
                            {% endif %}
                            
                            <div>
                                <label for="employee_type" class="block text-sm font-medium text-gray-700">Employee Type</label>
                                <select name="employee_type" id="employee_type" required class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                    <option value="">Select Employee Type</option>
                                    <option value="regular_officer" {% if edit_policy and edit_policy.employee_type == 'regular_officer' %}selected{% endif %}>Regular Officer</option>
                                    <option value="regular_executive" {% if edit_policy and edit_policy.employee_type == 'regular_executive' %}selected{% endif %}>Regular Executive</option>
                                    <option value="contractual_officer" {% if edit_policy and edit_policy.employee_type == 'contractual_officer' %}selected{% endif %}>Contractual Officer</option>
                                    <option value="contractual_executive" {% if edit_policy and edit_policy.employee_type == 'contractual_executive' %}selected{% endif %}>Contractual Executive</option>
                                </select>
                                {% if form.employee_type.errors %}
                                <p class="mt-2 text-sm text-red-600">{{ form.employee_type.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label for="leave_type" class="block text-sm font-medium text-gray-700">Leave Type</label>
                                <select name="leave_type" id="leave_type" required class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                    <option value="">Select Leave Type</option>
                                    {% for leave_type in leave_types %}
                                    <option value="{{ leave_type.id }}" {% if edit_policy and edit_policy.leave_type.id == leave_type.id %}selected{% endif %}>{{ leave_type.name }}</option>
                                    {% endfor %}
                                </select>
                                {% if form.leave_type.errors %}
                                <p class="mt-2 text-sm text-red-600">{{ form.leave_type.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label for="days_per_year" class="block text-sm font-medium text-gray-700">Days Per Year</label>
                                <input type="number" name="days_per_year" id="days_per_year" value="{% if edit_policy %}{{ edit_policy.days_per_year }}{% endif %}" required min="1" max="365" step="0.5" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                {% if form.days_per_year.errors %}
                                <p class="mt-2 text-sm text-red-600">{{ form.days_per_year.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            <div class="flex items-start">
                                <div class="flex items-center h-5">
                                    <input type="checkbox" name="can_carry_forward" id="can_carry_forward" {% if edit_policy and edit_policy.can_carry_forward %}checked{% endif %} class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded">
                                </div>
                                <div class="ml-3 text-sm">
                                    <label for="can_carry_forward" class="font-medium text-gray-700">Can Carry Forward</label>
                                    <p class="text-gray-500">Can unused leave be carried forward to next period?</p>
                                </div>
                            </div>
                            
                            <div id="carry_forward_fields" class="{% if not edit_policy or not edit_policy.can_carry_forward %}hidden{% endif %}">
                                <div>
                                    <label for="max_carry_forward" class="block text-sm font-medium text-gray-700">Max Carry Forward Days</label>
                                    <input type="number" name="max_carry_forward" id="max_carry_forward" value="{% if edit_policy %}{{ edit_policy.max_carry_forward }}{% endif %}" min="0" max="365" step="0.5" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    {% if form.max_carry_forward.errors %}
                                    <p class="mt-2 text-sm text-red-600">{{ form.max_carry_forward.errors.0 }}</p>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="flex items-start">
                                <div class="flex items-center h-5">
                                    <input type="checkbox" name="min_days_to_consume" id="min_days_to_consume_checkbox" {% if edit_policy and edit_policy.min_days_to_consume > 0 %}checked{% endif %} class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded">
                                </div>
                                <div class="ml-3 text-sm">
                                    <label for="min_days_to_consume_checkbox" class="font-medium text-gray-700">Minimum Days to Consume</label>
                                    <p class="text-gray-500">Is there a minimum number of days that must be consumed?</p>
                                </div>
                            </div>
                            
                            <div id="min_days_field" class="{% if not edit_policy or edit_policy.min_days_to_consume <= 0 %}hidden{% endif %}">
                                <div>
                                    <label for="min_days_to_consume_value" class="block text-sm font-medium text-gray-700">Minimum Days</label>
                                    <input type="number" name="min_days_to_consume_value" id="min_days_to_consume_value" value="{% if edit_policy and edit_policy.min_days_to_consume > 0 %}{{ edit_policy.min_days_to_consume }}{% endif %}" min="1" max="365" step="0.5" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                </div>
                            </div>
                            
                            <div class="flex justify-end">
                                {% if edit_policy %}
                                <a href="{% url 'leave_policy_management' %}#leave-policies" class="mr-3 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    Cancel
                                </a>
                                {% endif %}
                                <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    {% if edit_policy %}Update{% else %}Add{% endif %} Leave Policy
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Leave Policies List -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-green-500 to-green-700 text-white py-4 px-6">
                        <h2 class="text-lg font-semibold">Employee Leave Policies</h2>
                    </div>
                    <div class="p-6">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employee Type</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Leave Type</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Days Per Year</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Carry Forward</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Min Days to Consume</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for policy in leave_policies %}
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ policy.get_employee_type_display }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ policy.leave_type.name }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ policy.days_per_year }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full 
                                                {% if policy.can_carry_forward %}bg-green-100 text-green-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                                                {% if policy.can_carry_forward %}Yes (Max: {{ policy.max_carry_forward }}){% else %}No{% endif %}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            {% if policy.min_days_to_consume > 0 %}
                                            {{ policy.min_days_to_consume }} days
                                            {% else %}
                                            -
                                            {% endif %}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <a href="{% url 'edit_leave_policy' policy.id %}" class="text-blue-600 hover:text-blue-900 mr-3">Edit</a>
                                            <a href="{% url 'delete_leave_policy' policy.id %}" class="text-red-600 hover:text-red-900" onclick="return confirm('Are you sure you want to delete this leave policy?');">Delete</a>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="6" class="px-6 py-4 text-center text-sm text-gray-500">No leave policies found.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leave Periods Tab Content -->
    <div id="content-leave-periods" class="tab-content hidden">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Leave Period Form -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-700 text-white py-4 px-6">
                        <h2 class="text-lg font-semibold">{% if edit_period %}Edit{% else %}Add{% endif %} Leave Period</h2>
                    </div>
                    <div class="p-6">
                        <form method="post" action="{% url 'add_leave_period' %}" class="space-y-4">
                            {% csrf_token %}
                            {% if edit_period %}
                            <input type="hidden" name="period_id" value="{{ edit_period.id }}">
                            {% endif %}
                            
                            <div>
                                <label for="employee_type" class="block text-sm font-medium text-gray-700">Employee Type</label>
                                <select name="employee_type" id="employee_type" required class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                    <option value="">Select Employee Type</option>
                                    <option value="regular_officer" {% if edit_period and edit_period.employee_type == 'regular_officer' %}selected{% endif %}>Regular Officer</option>
                                    <option value="regular_executive" {% if edit_period and edit_period.employee_type == 'regular_executive' %}selected{% endif %}>Regular Executive</option>
                                    <option value="contractual_officer" {% if edit_period and edit_period.employee_type == 'contractual_officer' %}selected{% endif %}>Contractual Officer</option>
                                    <option value="contractual_executive" {% if edit_period and edit_period.employee_type == 'contractual_executive' %}selected{% endif %}>Contractual Executive</option>
                                </select>
                                {% if form.employee_type.errors %}
                                <p class="mt-2 text-sm text-red-600">{{ form.employee_type.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="period_start_month" class="block text-sm font-medium text-gray-700">Start Month</label>
                                    <select name="period_start_month" id="period_start_month" required class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                        <option value="">Select Month</option>
                                        <option value="1" {% if edit_period and edit_period.period_start_month == 1 %}selected{% endif %}>January</option>
                                        <option value="2" {% if edit_period and edit_period.period_start_month == 2 %}selected{% endif %}>February</option>
                                        <option value="3" {% if edit_period and edit_period.period_start_month == 3 %}selected{% endif %}>March</option>
                                        <option value="4" {% if edit_period and edit_period.period_start_month == 4 %}selected{% endif %}>April</option>
                                        <option value="5" {% if edit_period and edit_period.period_start_month == 5 %}selected{% endif %}>May</option>
                                        <option value="6" {% if edit_period and edit_period.period_start_month == 6 %}selected{% endif %}>June</option>
                                        <option value="7" {% if edit_period and edit_period.period_start_month == 7 %}selected{% endif %}>July</option>
                                        <option value="8" {% if edit_period and edit_period.period_start_month == 8 %}selected{% endif %}>August</option>
                                        <option value="9" {% if edit_period and edit_period.period_start_month == 9 %}selected{% endif %}>September</option>
                                        <option value="10" {% if edit_period and edit_period.period_start_month == 10 %}selected{% endif %}>October</option>
                                        <option value="11" {% if edit_period and edit_period.period_start_month == 11 %}selected{% endif %}>November</option>
                                        <option value="12" {% if edit_period and edit_period.period_start_month == 12 %}selected{% endif %}>December</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label for="period_start_day" class="block text-sm font-medium text-gray-700">Start Day</label>
                                    <input type="number" name="period_start_day" id="period_start_day" value="{% if edit_period %}{{ edit_period.period_start_day }}{% endif %}" required min="1" max="31" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="period_end_month" class="block text-sm font-medium text-gray-700">End Month</label>
                                    <select name="period_end_month" id="period_end_month" required class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                        <option value="">Select Month</option>
                                        <option value="1" {% if edit_period and edit_period.period_end_month == 1 %}selected{% endif %}>January</option>
                                        <option value="2" {% if edit_period and edit_period.period_end_month == 2 %}selected{% endif %}>February</option>
                                        <option value="3" {% if edit_period and edit_period.period_end_month == 3 %}selected{% endif %}>March</option>
                                        <option value="4" {% if edit_period and edit_period.period_end_month == 4 %}selected{% endif %}>April</option>
                                        <option value="5" {% if edit_period and edit_period.period_end_month == 5 %}selected{% endif %}>May</option>
                                        <option value="6" {% if edit_period and edit_period.period_end_month == 6 %}selected{% endif %}>June</option>
                                        <option value="7" {% if edit_period and edit_period.period_end_month == 7 %}selected{% endif %}>July</option>
                                        <option value="8" {% if edit_period and edit_period.period_end_month == 8 %}selected{% endif %}>August</option>
                                        <option value="9" {% if edit_period and edit_period.period_end_month == 9 %}selected{% endif %}>September</option>
                                        <option value="10" {% if edit_period and edit_period.period_end_month == 10 %}selected{% endif %}>October</option>
                                        <option value="11" {% if edit_period and edit_period.period_end_month == 11 %}selected{% endif %}>November</option>
                                        <option value="12" {% if edit_period and edit_period.period_end_month == 12 %}selected{% endif %}>December</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label for="period_end_day" class="block text-sm font-medium text-gray-700">End Day</label>
                                    <input type="number" name="period_end_day" id="period_end_day" value="{% if edit_period %}{{ edit_period.period_end_day }}{% endif %}" required min="1" max="31" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                </div>
                            </div>
                            
                            <div class="flex items-start">
                                <div class="flex items-center h-5">
                                    <input type="checkbox" name="is_based_on_contract" id="is_based_on_contract" {% if edit_period and edit_period.is_based_on_contract %}checked{% endif %} class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded">
                                </div>
                                <div class="ml-3 text-sm">
                                    <label for="is_based_on_contract" class="font-medium text-gray-700">Based on Contract</label>
                                    <p class="text-gray-500">Is the leave period based on employee's contract start date?</p>
                                </div>
                            </div>
                            
                            <div class="flex justify-end">
                                {% if edit_period %}
                                <a href="{% url 'leave_policy_management' %}#leave-periods" class="mr-3 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    Cancel
                                </a>
                                {% endif %}
                                <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    {% if edit_period %}Update{% else %}Add{% endif %} Leave Period
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Leave Periods List -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-green-500 to-green-700 text-white py-4 px-6">
                        <h2 class="text-lg font-semibold">Leave Periods</h2>
                    </div>
                    <div class="p-6">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employee Type</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Start Date</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">End Date</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Based on Contract</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for period in leave_periods %}
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ period.get_employee_type_display }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ period.get_start_month_name }} {{ period.period_start_day }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ period.get_end_month_name }} {{ period.period_end_day }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full 
                                                {% if period.is_based_on_contract %}bg-purple-100 text-purple-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                                                {% if period.is_based_on_contract %}Yes{% else %}No{% endif %}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <a href="{% url 'edit_leave_period' period.id %}" class="text-blue-600 hover:text-blue-900 mr-3">Edit</a>
                                            <a href="{% url 'delete_leave_period' period.id %}" class="text-red-600 hover:text-red-900" onclick="return confirm('Are you sure you want to delete this leave period?');">Delete</a>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">No leave periods found.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Tab switching functionality
        const tabLeaveTypes = document.getElementById('tab-leave-types');
        const tabLeavePolicies = document.getElementById('tab-leave-policies');
        const tabLeavePeriods = document.getElementById('tab-leave-periods');
        const contentLeaveTypes = document.getElementById('content-leave-types');
        const contentLeavePolicies = document.getElementById('content-leave-policies');
        const contentLeavePeriods = document.getElementById('content-leave-periods');
        
        // Function to set active tab
        function setActiveTab(activeTab, activeContent) {
            // Reset all tabs
            [tabLeaveTypes, tabLeavePolicies, tabLeavePeriods].forEach(tab => {
                tab.classList.remove('border-blue-500', 'text-blue-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Reset all content
            [contentLeaveTypes, contentLeavePolicies, contentLeavePeriods].forEach(content => {
                content.classList.add('hidden');
            });
            
            // Set active tab
            activeTab.classList.add('border-blue-500', 'text-blue-600');
            activeTab.classList.remove('border-transparent', 'text-gray-500');
            
            // Show active content
            activeContent.classList.remove('hidden');
        }
        
        tabLeaveTypes.addEventListener('click', function() {
            setActiveTab(tabLeaveTypes, contentLeaveTypes);
            window.location.hash = 'leave-types';
        });
        
        tabLeavePolicies.addEventListener('click', function() {
            setActiveTab(tabLeavePolicies, contentLeavePolicies);
            window.location.hash = 'leave-policies';
        });
        
        tabLeavePeriods.addEventListener('click', function() {
            setActiveTab(tabLeavePeriods, contentLeavePeriods);
            window.location.hash = 'leave-periods';
        });
        
        // Check URL hash on page load
        if (window.location.hash) {
            if (window.location.hash === '#leave-policies') {
                setActiveTab(tabLeavePolicies, contentLeavePolicies);
            } else if (window.location.hash === '#leave-periods') {
                setActiveTab(tabLeavePeriods, contentLeavePeriods);
            } else {
                setActiveTab(tabLeaveTypes, contentLeaveTypes);
            }
        }
        
        // Carry forward checkbox toggle
        const canCarryForwardCheckbox = document.getElementById('can_carry_forward');
        const carryForwardFields = document.getElementById('carry_forward_fields');
        
        if (canCarryForwardCheckbox && carryForwardFields) {
            canCarryForwardCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    carryForwardFields.classList.remove('hidden');
                } else {
                    carryForwardFields.classList.add('hidden');
                }
            });
        }
        
        // Min days to consume checkbox toggle
        const minDaysCheckbox = document.getElementById('min_days_to_consume_checkbox');
        const minDaysField = document.getElementById('min_days_field');
        
        if (minDaysCheckbox && minDaysField) {
            minDaysCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    minDaysField.classList.remove('hidden');
                } else {
                    minDaysField.classList.add('hidden');
                }
            });
        }
        
        // Validate day values based on selected month
        const periodStartMonth = document.getElementById('period_start_month');
        const periodStartDay = document.getElementById('period_start_day');
        const periodEndMonth = document.getElementById('period_end_month');
        const periodEndDay = document.getElementById('period_end_day');
        
        function updateDayValidation(monthSelect, dayInput) {
            if (!monthSelect || !dayInput) return;
            
            monthSelect.addEventListener('change', function() {
                const month = parseInt(this.value);
                let maxDay = 31;
                
                if ([4, 6, 9, 11].includes(month)) {
                    maxDay = 30;
                } else if (month === 2) {
                    maxDay = 29; // Accounting for leap years
                }
                
                dayInput.max = maxDay;
                if (parseInt(dayInput.value) > maxDay) {
                    dayInput.value = maxDay;
                }
            });
        }
        
        updateDayValidation(periodStartMonth, periodStartDay);
        updateDayValidation(periodEndMonth, periodEndDay);
    });
</script>
{% endblock %}